"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5620],{25620:(be,w,a)=>{a.r(w),a.d(w,{Router:()=>Be});var e=a(14041),z=a(73657),P=a(18690),U=a(16732),j=a(77189),v=a(29743),f=a(56703),g=a(23180),D=a(11638),R=a(7877),M=a(92651),h=a(97093),Y=a(64947),F=a(29365),k=a(5893),q=a(25534),ee=a(99993),te=a(17899),L=a(29835),ae=a(29587),ne=a(69561),W=a(58837),G=a(95061),V=a(48543),$=a(81215),X=a(26343),J=a(40703),H=a(45685),Z=a(48653),le=a(88951),Q=a(32881),oe=a(98269),b=a(51419),re=a(16983),se=a(94403),ie=a(91638),ce=a(53373),Ne=a.n(ce),we=a(52950),me=a(4794),ze=a.n(me),Ee=a(45810),je=a.n(Ee),de=a(96403),Ye=a.n(de),ue=a(4237),Ge=a.n(ue),Ve=a(63177),_e=a(56005),$e=a.n(_e);const pe=t=>{const{title:n,to:l}=t,{allowed:i}=(0,te.JT)({permission:ee.C4}),r=(0,k.A)(m=>m.breakpoints.down("xs"));return!l||!i?null:r?e.createElement(F.A,{component:z.N_,color:"primary",title:n,size:"small",to:l},e.createElement(q.A,null)):e.createElement(Y.A,{component:z.N_,variant:"contained",color:"primary",to:l},n)},fe={title:"Templates",filter:()=>!0},ve=t=>[...t,{title:"Other Templates",filter:n=>![...t].some(({filter:l})=>l(n))}],Oe=t=>{var n,l,i;const r=(0,D.Sf)(f.u),{TemplateCardComponent:m,groups:s=[],templateFilter:p,headerOptions:_}=t,c=(0,P.Zp)(),u=(0,D.Sf)(f.p),A=(0,D.Sf)(f.q),E=(0,D.Sf)(f.t),O=(0,D.Sf)(f.v),C=(0,D.Sf)(f.o),T=(0,D.nm)(),o=s.length?ve(s):[fe],d={onEditorClicked:((n=t==null?void 0:t.contextMenu)==null?void 0:n.editor)!==!1?()=>c(u()):void 0,onActionsClicked:((l=t==null?void 0:t.contextMenu)==null?void 0:l.actions)!==!1?()=>c(A()):void 0,onTasksClicked:((i=t==null?void 0:t.contextMenu)==null?void 0:i.tasks)!==!1?()=>c(E()):void 0},y=(0,e.useCallback)(B=>{var K,S;const{kind:Ke,namespace:Se,name:Fe}=(0,L.KU)((0,L.U2)(B));return(K=B.metadata.annotations)!=null&&K["backstage.io/techdocs-ref"]&&O?[{icon:(S=T.getSystemIcon("docs"))!=null?S:g.Vf,text:"View TechDocs",url:O({kind:Ke,namespace:Se,name:Fe})}]:[]},[T,O]),x=(0,e.useCallback)(B=>{const{namespace:K,name:S}=(0,L.KU)((0,L.U2)(B));c(C({namespace:K,templateName:S}))},[c,C]);return e.createElement(M.B9,null,e.createElement(g.YW,{themeId:"home"},e.createElement(g.Y9,{pageTitleOverride:"Create a new component",title:"Create a new component",subtitle:"Create new software components using standard templates in your organization",..._},e.createElement(h.RO,{...d})),e.createElement(g.UC,null,e.createElement(g.dv,{title:"Available Templates"},e.createElement(pe,{title:"Register Existing Component",to:r&&r()}),e.createElement(g.Yl,null,"Create new software components using standard templates. Different templates create different kinds of components (services, websites, documentation, ...).")),e.createElement(M.GI,null,e.createElement(M.GI.Filters,null,e.createElement(M.lD,null),e.createElement(M.mb,{initialFilter:"template",hidden:!0}),e.createElement(M.y2,{initialFilter:"all",availableFilters:["all","starred"]}),e.createElement(h.he,null),e.createElement(M.mo,null)),e.createElement(M.GI.Content,null,e.createElement(h.hJ,{groups:o,templateFilter:p,TemplateCardComponent:m,onTemplateSelected:x,additionalLinksForEntity:y}))))))},Pe=t=>{const n=(0,D.Sf)(f.r),l=(0,D.Sf)(f.w),{secrets:i}=(0,U.u)(),r=(0,R.u)(U.s),m=(0,P.Zp)(),{templateName:s,namespace:p}=(0,D.KS)(f.o),_=(0,L.U2)({kind:"Template",namespace:p,name:s}),c=async A=>{const{taskId:E}=await r.scaffold({templateRef:_,values:A,secrets:i});m(l({taskId:E}))},u=()=>e.createElement(P.C5,{to:n()});return e.createElement(D.Ig,{attributes:{entityRef:_}},e.createElement(g.YW,{themeId:"website"},e.createElement(g.Y9,{pageTitleOverride:"Create a new component",title:"Create a new component",subtitle:"Create new software components using standard templates in your organization",...t.headerOptions}),e.createElement(h.Wu,{namespace:p,templateName:s,onCreate:c,components:t.components,onError:u,extensions:t.customFieldExtensions,formProps:t.formProps,layouts:t.layouts})))};var ge=Object.defineProperty,Ae=(t,n,l)=>n in t?ge(t,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[n]=l,De=(t,n,l)=>(Ae(t,typeof n!="symbol"?n+"":n,l),l);const Ce=(0,W.A)({containerWrapper:{position:"relative",width:"100%",height:"100%"},container:{position:"absolute",top:0,bottom:0,left:0,right:0,overflow:"auto"}});class Me extends e.Component{constructor(){super(...arguments),De(this,"state",{shouldRender:!0})}componentDidUpdate(n){n.invalidator!==this.props.invalidator&&this.setState({shouldRender:!0})}componentDidCatch(n){this.props.setErrorText(n.message),this.setState({shouldRender:!1})}render(){return this.state.shouldRender?this.props.children:null}}function N(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function I(t){const{content:n,contentIsSpec:l,onDryRun:i,setErrorText:r,fieldExtensions:m=[],layouts:s=[]}=t,p=Ce(),_=(0,R.b)(),[c,u]=(0,e.useState)(),A=(0,e.useMemo)(()=>Object.fromEntries(m.map(({name:E,component:O})=>[E,O])),[m]);return(0,re.A)(()=>{try{if(!n){u(void 0);return}const E=b.Ay.parseAllDocuments(n).filter(o=>o).map(o=>o.toJSON())[0];if(!N(E)){u(void 0);return}let O=E;if(!l){if(!(String(E.kind).toLocaleLowerCase("en-US")==="template")){u(void 0);return}O=N(E.spec)?E.spec:{}}const{parameters:C}=O;if(!Array.isArray(C)){r("Template parameters must be an array"),u(void 0);return}const T=Object.fromEntries(m.map(({name:o,validation:d})=>[o,d]));r(),u(C.flatMap(o=>N(o)?[{title:String(o.title),schema:o,validate:(0,h.KE)(o,T,{apiHolder:_})}]:[]))}catch(E){r(E.message)}},250,[l,n,_]),c?e.createElement("div",{className:p.containerWrapper},e.createElement("div",{className:p.container},e.createElement(Me,{invalidator:c,setErrorText:r},e.createElement(h.C1,{manifest:{steps:c,title:"Template Editor"},extensions:m,components:A,onCreate:async E=>{await(i==null?void 0:i(E))},layouts:s})))):null}function Te(t){const{setErrorText:n,fieldExtensions:l=[],layouts:i}=t,r=(0,v.u)(),m=(0,v.a)(),{selectedFile:s}=m,p=async c=>{if(s)try{await r.execute({templateContent:s.content,values:c,files:m.files}),n()}catch(u){throw n(String(u.cause||u)),u}},_=s&&s.path.match(/\.ya?ml$/)?s.content:void 0;return e.createElement(I,{onDryRun:p,fieldExtensions:l,setErrorText:n,content:_,layouts:i})}I.DirectoryEditorDryRun=Te;const he=(0,W.A)(t=>({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "controls controls"
      "fieldForm preview"
    `,gridTemplateRows:"auto 1fr",gridTemplateColumns:"1fr 1fr"},controls:{gridArea:"controls",display:"flex",flexFlow:"row nowrap",alignItems:"center",margin:t.spacing(1)},fieldForm:{gridArea:"fieldForm"},preview:{gridArea:"preview"}})),ye=({customFieldExtensions:t=[],onClose:n})=>{var l,i;const r=he(),m=t.filter(o=>!!o.schema),[s,p]=(0,e.useState)(m[0]),[_,c]=(0,e.useState)({}),[u,A]=(0,e.useState)(Date.now()),E=(0,e.useMemo)(()=>{var o,d;return b.Ay.stringify({parameters:[{title:`${s.name} Example`,properties:{[s.name]:{type:(d=(o=s.schema)==null?void 0:o.returnValue)==null?void 0:d.type,"ui:field":s.name,"ui:options":_}}}]})},[_,s]),O=(0,e.useMemo)(()=>Object.fromEntries(t.map(({name:o,component:d})=>[o,d])),[t]),C=(0,e.useCallback)(o=>{p(o),c({})},[c,p]),T=(0,e.useCallback)(o=>{c(o),A(Date.now())},[c,A]);return e.createElement("main",{className:r.root},e.createElement("div",{className:r.controls},e.createElement(G.A,{variant:"outlined",size:"small",fullWidth:!0},e.createElement(V.A,{id:"select-field-label"},"Choose Custom Field Extension"),e.createElement($.A,{value:s,label:"Choose Custom Field Extension",labelId:"select-field-label",onChange:o=>C(o.target.value)},m.map((o,d)=>e.createElement(X.A,{key:d,value:o},o.name)))),e.createElement(F.A,{size:"medium",onClick:n,"aria-label":"Close"},e.createElement(Q.A,null))),e.createElement("div",{className:r.fieldForm},e.createElement(J.A,null,e.createElement(H.A,{title:"Field Options"}),e.createElement(Z.A,null,e.createElement(h.lV,{showErrorList:!1,fields:{...O},noHtml5Validate:!0,formData:_,formContext:{fieldFormState:_},onSubmit:o=>T(o.formData),validator:se.Ay,schema:((l=s.schema)==null?void 0:l.uiOptions)||{},experimental_defaultFormStateBehavior:{allOf:"populateDefaults"}},e.createElement(Y.A,{variant:"contained",color:"primary",type:"submit",disabled:!((i=s.schema)!=null&&i.uiOptions)},"Apply"))))),e.createElement("div",{className:r.preview},e.createElement(J.A,null,e.createElement(H.A,{title:"Example Template Spec"}),e.createElement(Z.A,null,e.createElement(oe.Ay,{readOnly:!0,theme:"dark",height:"100%",extensions:[ae.Tg.define(ne.o)],value:E}))),e.createElement(I,{key:u,content:E,contentIsSpec:!0,fieldExtensions:t,setErrorText:()=>null})))},Re=(0,W.A)({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "browser editor preview"
      "results results results"
    `,gridTemplateColumns:"1fr 3fr 2fr",gridTemplateRows:"1fr auto"},browser:{gridArea:"browser",overflow:"auto"},editor:{gridArea:"editor",overflow:"auto"},preview:{gridArea:"preview",overflow:"auto"},results:{gridArea:"results"}}),Le=t=>{const n=Re(),[l,i]=(0,e.useState)();return e.createElement(v.D,{directory:t.directory},e.createElement(v.b,null,e.createElement("main",{className:n.root},e.createElement("section",{className:n.browser},e.createElement(v.T,{onClose:t.onClose})),e.createElement("section",{className:n.editor},e.createElement(v.c.DirectoryEditor,{errorText:l})),e.createElement("section",{className:n.preview},e.createElement(I.DirectoryEditorDryRun,{setErrorText:i,fieldExtensions:t.fieldExtensions,layouts:t.layouts})),e.createElement("section",{className:n.results},e.createElement(v.d,null)))))},Ie=`# Edit the template parameters below to see how they will render in the scaffolder form UI
parameters:
  - title: Fill in some steps
    required:
      - name
    properties:
      name:
        title: Name
        type: string
        description: Unique name of the component
      owner:
        title: Owner
        type: string
        description: Owner of the component
        ui:field: OwnerPicker
        ui:options:
          catalogFilter:
            kind: Group
  - title: Choose a location
    required:
      - repoUrl
    properties:
      repoUrl:
        title: Repository Location
        type: string
        ui:field: RepoUrlPicker
        ui:options:
          allowedHosts:
            - github.com
steps:
  - id: fetch-base
    name: Fetch Base
    action: fetch:template
    input:
      url: ./template
      values:
        name: \${{parameters.name}}
`,Ue=(0,W.A)(t=>({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "controls controls"
      "textArea preview"
    `,gridTemplateRows:"auto 1fr",gridTemplateColumns:"1fr 1fr"},controls:{gridArea:"controls",display:"flex",flexFlow:"row nowrap",alignItems:"center",margin:t.spacing(1)},textArea:{gridArea:"textArea"},preview:{gridArea:"preview"}})),We=({defaultPreviewTemplate:t=Ie,customFieldExtensions:n=[],onClose:l,layouts:i=[]})=>{const r=Ue(),m=(0,R.u)(R.l),s=(0,R.u)(M.vp),[p,_]=(0,e.useState)(""),[c,u]=(0,e.useState)(),[A,E]=(0,e.useState)([]),[O,C]=(0,e.useState)(t),{loading:T}=(0,ie.default)(()=>s.getEntities({filter:{kind:"template"},fields:["kind","metadata.namespace","metadata.name","metadata.title","spec.parameters","spec.steps","spec.output"]}).then(({items:d})=>E(d.map(y=>{var x;return{label:(x=y.metadata.title)!=null?x:(0,M.SE)(y,{defaultKind:"template"}),value:y}}))).catch(d=>m.post({message:`Error loading exisiting templates: ${d.message}`,severity:"error"})),[s]),o=(0,e.useCallback)(d=>{_(d),C(b.Ay.stringify(d.spec))},[C]);return e.createElement(e.Fragment,null,T&&e.createElement(le.A,null),e.createElement("main",{className:r.root},e.createElement("div",{className:r.controls},e.createElement(G.A,{variant:"outlined",size:"small",fullWidth:!0},e.createElement(V.A,{id:"select-template-label"},"Load Existing Template"),e.createElement($.A,{value:p,label:"Load Existing Template",labelId:"select-template-label",onChange:d=>o(d.target.value)},A.map((d,y)=>e.createElement(X.A,{key:y,value:d.value},d.label)))),e.createElement(F.A,{size:"medium",onClick:l},e.createElement(Q.A,null))),e.createElement("div",{className:r.textArea},e.createElement(v.c,{content:O,onUpdate:C,errorText:c})),e.createElement("div",{className:r.preview},e.createElement(I,{content:O,contentIsSpec:!0,fieldExtensions:n,setErrorText:u,layouts:i}))))};function xe(t){const[n,l]=(0,e.useState)();let i=null;return(n==null?void 0:n.type)==="local"?i=e.createElement(Le,{directory:n.directory,fieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0),layouts:t.layouts}):(n==null?void 0:n.type)==="form"?i=e.createElement(We,{defaultPreviewTemplate:t.defaultPreviewTemplate,customFieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0),layouts:t.layouts}):(n==null?void 0:n.type)==="field-explorer"?i=e.createElement(ye,{customFieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0)}):i=e.createElement(g.UC,null,e.createElement(v.e,{onSelect:r=>{r==="local"?v.W.requestDirectoryAccess().then(m=>l({type:"local",directory:m})).catch(()=>{}):r==="form"?l({type:"form"}):r==="field-explorer"&&l({type:"field-explorer"})}})),e.createElement(g.YW,{themeId:"home"},e.createElement(g.Y9,{title:"Template Editor",subtitle:"Edit, preview, and try out templates and template forms"}),i)}const Be=t=>{const{components:{TemplateCardComponent:n,TaskPageComponent:l=f.e,ReviewStepComponent:i,EXPERIMENTAL_TemplateOutputsComponent:r,EXPERIMENTAL_TemplateListPageComponent:m=Oe,EXPERIMENTAL_TemplateWizardPageComponent:s=Pe}={}}=t,p=(0,P.P1)()||t.children,_=(0,j.l3)(p),c=[..._,...v.f.filter(({name:A})=>!_.some(E=>E.name===A))],u=(0,j.cw)(p);return e.createElement(P.BV,null,e.createElement(P.qh,{path:"/",element:e.createElement(m,{TemplateCardComponent:n,contextMenu:t.contextMenu,groups:t.groups,templateFilter:t.templateFilter,headerOptions:t.headerOptions})}),e.createElement(P.qh,{path:f.o.path,element:e.createElement(U.S,null,e.createElement(s,{headerOptions:t.headerOptions,customFieldExtensions:c,layouts:u,components:{ReviewStepComponent:i},formProps:t.formProps}))}),e.createElement(P.qh,{path:f.w.path,element:e.createElement(l,{TemplateOutputsComponent:r})}),e.createElement(P.qh,{path:f.p.path,element:e.createElement(U.S,null,e.createElement(xe,{customFieldExtensions:c,layouts:u}))}),e.createElement(P.qh,{path:f.q.path,element:e.createElement(v.A,null)}),e.createElement(P.qh,{path:f.t.path,element:e.createElement(v.L,null)}),e.createElement(P.qh,{path:"*",element:e.createElement(g.M,{status:"404",statusMessage:"Page not found"})}))}}}]);})();

//# sourceMappingURL=5620.0a40e15a.chunk.js.map